#输码抽微信红包


## 安全！！！
* `codeManager`目录下的文件因为可以直接没有限制的修改数据，所以必须在需要使用的时候再上传至
服务器中安全的路径中，以防被人随意访问。并且在使用完成后立刻删除。
* `manage`目录的文件可以在本地环境运行，所以不要上传服务器
* 商户平台的证书必须存放在服务器中不能被从外部直接访问到的目录中




## 注意
* 该项目只包括前端和微信接口部分，不包含后端兑换码处理和数据库的相关内容
* 当前兑换码规则是9位英文字母或数字，如果要变，修改`handleRedPacketDraw.php`中正则表达式

## 商户需要的设置、需要提供的参数和文件
1. 开通红包功能：【微信支付商户平台——产品中心——现金红包——开通】
2. 提供API证书：【微信支付商户平台——账户中心——账户设置——API安全——下载证书】（PHP开发只需要两个pem后缀的证书）
3. 充值：【微信支付商户平台——交易中心——资金管理——充值】
4. 提供微信公众平台的Appid和AppSecret：【微信公众平台——开发——基本设置】
5. 提供微信支付商户平台商户号：【微信支付商户平台——账户中心——商户设置——基本账户信息——微信支付商户号】
6. 提供商户key（在如下路径设置自定义key）：【微信支付商户平台——账户中心——账户设置——API安全——密钥设置
】
6. 商户名称、红包祝福语、活动名称、红包备注信息。（这些信息将显示在发出的红包中）
7. 设置红包参数：【微信支付商户平台——产品中心——现金红包——产品设置】
    * 设定红包额度范围
    * 调用IP地址：填写开发服务器IP地址
    * 用户领取上限：根据需要设定
    * 防刷等级：根据需要设定
8. 制定红包发放规则：活动投入金额、单个红包金额、奖金概率等。

## 拥有微信网页回调域名情况下的使用方法（自己获取用户OpenID）
1. 下载证书：PHP只需要以`cert.pem`和`key.pem`结尾的两个证书，下载后放到 `manage/userGenerator/` 中
2. 运行 ```manage/userGenerator```中的```generator.php```，填写所有表单后，点击“生成（使用了自己的回调域名）”按钮，生成配置文件、证书重命名
3. 把证书放到安全的地方。
4. 在```WechatRedPack/```内的```RedPacket.class.php```中引用两个证书的url
5. 把配置文件放到 ```WechatRedPack/merchantsInfo/```，该配置文件中有一行注释，是微信授权页的url，作为用户访问入口
6. 在```handleRedPacketDraw.php```中，引入你自己的后端兑换码检验代码。本例引入了```check_code.php```并使用了```WXredPacket```类
7. 根据你自己的情况，修改不同结果时的提示文字

## 没有微信网页回调域名情况下的使用方法（需要通过拥有域名的第三方转发OpenID）

## 微信接口
* [现金红包](https://pay.weixin.qq.com/wiki/doc/api/tools/cash_coupon.php?chapter=13_1)
